---
title: "Forecasting Nuclear Proliferation"
author: "Spencer Graves (and Doug Samuelson?)"
date: "2020-01-25"
output: bookdown::pdf_book
#output: bookdown::gitbook
#NOTE:  As of 2019-11 "Figure \@ref(fig:plot)" 
# does not work with 
# output: html_document 
bibliography: nuc-references.bib
vignette: >
  %\VignetteIndexEntry{Time to next new nuclear-weapon state}
  %\VignetteKeyword{nuclear-weapon states}
  %\VignetteEngine{knitr::knitr}
  %\SweaveUTF8
  \usepackage[utf8](inputenc)
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Ecdat::nuclearWeaponStates include all 
# first test up to nukeDataCurrent:  
nukeDataCurrent <- as.Date('2020-01-25')
```

# Abstract

This article models the time between the first test of a nuclear weapon by one nation and the next over the 74.5 years of history since the first such test by the US.  We use those results to forecast nuclear proliferation over the next 74 years.  The maximum likelihoood estimate of the time between first tests using censored estimation of a constant exponential distribution is 74.5 / 8 = 9.3 years.  However, a plot of the times between "first tests" of the 9 nuclear powers as of `r nukeDataCurrent` suggests a nonhomogeneous [renewal process](https://en.wikipedia.org/wiki/Renewal_theory) that suggests a linear decrease over time in log(Poisson mean) of the number of "first tests" each year by new nuclear-weapon states.  This can be modeled using [`glm(..., family=poisson)`](https://www.rdocumentation.org/packages/stats/versions/3.6.1/topics/glm).  Unfortunately, the linear trend is not statistically signficant.  We therefore use Bayesian Model Averaging (BMA), considering two related BMA mixtures.  This average of the Monte Carlo simulations for the constant-linear mixture forecasts an addition 5.4 new nuclear-weapon states by 2093.  The average nonlinear mixture forecasts an addition 7.3 new nuclear-weapon states by 2093.  Eighty percent percent prediction limits run from 0 to 14 new nuclear-weapon states, within the typical life span of babies born today.  Even without the 10 percent of simulations above the upper prediction limits, it should be clear that the risks of a nuclear war leading to the extinction of civilization is increasing.  Nuclear proliferation will likely continue until it becomes effectively impossible for anyone to make more nuclear weapons for a very long time.  This could come from a nuclear war or a massive and unprecidented strengthening of international law that provides effective judicial recourse for grievances of the poor, weak and disfranchised.  

# Introduction 

A plot of times between "first tests" by the world's nuclear-weapon states as of `r nukeDataCurrent` suggests that the process of nuclear proliferation has slowed;  see Figure \@ref(fig:plot). 

```{r, plot, fig.cap = "Time between new nuclear-weapon states"}
library(Ecdat)
data(nuclearWeaponStates)
ymax <- max(
  nuclearWeaponStates$yearsSinceLastFirstTest, 
            na.rm=TRUE)
ylim0 <- c(0, ymax)

NPTdate = as.Date('1970-03-05')
plotNucStates <- function(type.='n', xlim., ylim., 
    line_mtext=3:2, cex.=1, mtext.=TRUE, log.='', 
    ...){
##
## Write a function to create this desired plot
## that is general enough to be customized 
## to make other similar but different plots 
## later.  
## 
## Obviously, during the process of writing 
## this vignette, it requires revising this 
## function later as the needs become clearer.  
##  
## The advantage of doing it this way, it that
## it makes the code easier to read, because 
## it's clearer it clearer what is the same and 
## what is different between similar plots.  
##
#   Start with an internal function 
#   to add the 2-letter country codes.     
  addCountries <- function(line_mtext=3:2, cex.=1, 
                           mtext.=TRUE){
#  Add the country codes ("ctry") to a plot 
#  showing the time between "first tests" 
#  of nuclear-weapon states
# ... to save copying code 
#  and hopefully make the logic clearer
    xlab. <- paste(c(
        'Note: The US is not on this plot,',
        'because it had no predecessors.'), 
               collapse='\n')
    if(mtext.){
        mtext(xlab., 1, line_mtext[1], cex=cex.)
        mtext('years from the\nprevious "first test"',
          2, line_mtext[2], cex=cex.)
    }
    with(nuclearWeaponStates, 
        text(firstTest, yearsSinceLastFirstTest,
          ctry, xpd=TRUE, cex=cex.))
  }
#  xlim and ylim?
  if(missing(xlim.))xlim. <- range(
    nuclearWeaponStates$firstTest)
  if(missing(ylim.))ylim. <- range(
    nuclearWeaponStates$yearsSinceLastFirstTest[-1])
# If very wide log scale on y, 
# make the margins wider and move the label out:    
  if((log.=='y') && (diff(log(ylim.))>5)){
    op <- par(mar=c(5, 6, 4, 2)+0.1)
    on.exit(par(op))
    line_mtext[2] <- 4
  } 
#  
  plot(yearsSinceLastFirstTest~firstTest, 
       nuclearWeaponStates, type=type., 
       xlab='', ylab='', las=1, 
       xlim=xlim., ylim=ylim., log=log., bty='n', 
       ...)
  abline(v=NPTdate, lty='dashed', col='grey')
  ymid <- {
    if(log.=='y') sqrt(ylim.[1]*ylim.[2]) else 
      mean(ylim.)
  }
  text(NPTdate-.017*diff(xlim.), 
       ymid, 'NPT', col='grey', srt=90)
  addCountries(line_mtext=line_mtext, cex.=cex., 
               mtext.=mtext.)
}    
plotNucStates(type.='h', ylim.=ylim0)
```

It stretches credibility to suggest that nuclear proliferation has stopped.  There were only 5 nuclear-weapon states when the [Treaty on the Non-Proliferation of Nuclear Weapons (NPT, Non-proliferation treaty)](https://en.wikipedia.org/wiki/Treaty_on_the_Non-Proliferation_of_Nuclear_Weapons) entered into force in 1970.^[@UN:1970.  See also @Wikip:NPT.]  When US President [George W. Bush](https://en.wikipedia.org/wiki/George_W._Bush) decried an ["Axis of evil"](https://en.wikipedia.org/wiki/Axis_of_evil) in his State of the Union message, 2002-01-29,^[@Bush:2002;  see also @Wikip:AxisOfEvil.] there were 8.  As this is written `r nukeDataCurrent`, there are 9.  @Toon:2007 noted that in 2003 another 32 had sufficient fissile material to make nuclear weapons if they wished.  

Moreover, those 32 do _NOT_ include either Turkey nor Saudi Arabia.  On 2019-09-04, Turkish President Erdogan said it was unacceptable for nuclear-armed states to forbid Turkey from acquiring its own nuclear weapons.^[@Toksabay:2019; @OConnor:2019.] 

Similarly, in 2006 *Forbes* reported that Saudi Arabia has "a secret underground city and dozens of underground silos for" Pakistani nuclear weapons and missiles.^[@Forbes:2006;  see also @Wikip:SaudiNuc.] In 2018 the *Middle East Monitor* reported that "Israel 'is selling nuclear information' to Saudi Arabia".^[@MEM:SaudiNuc;  see also @Wikip:SaudiNuc.]  This is particularly disturbing, because of the substantial evidence that Saudi Arabia may have been and may still be the primary recruiter and funder of Islamic terrorism.^[@Benjamin:2016; see also @Wikiv:WinTerror.]  

This analysis suggests that the number of nuclear-weapon states will likely continue to grow until either (i) a nuclear war destroys the ability of anyone to make more nuclear weapons, or (ii) the fundamental structure of international relations changes to the point that any nation that perceives an external threat can confidently rely on international law for protection, without a military that might threaten other countries.

This vignette first reviews the data and history on this issue including brief discussions of what might have motivated different nations to pursue nuclear weapons.  We then consider modeling these data as a series of annual Poisson observations of the number of states conducting a first test of a nuclear weapon each year (1 in each of 8 years since 1945; 0 in the others).

The simplest such model that considers the possible inhomogeniety visible in Figure \@ref(fig:plot) is [Poisson regression](https://en.wikipedia.org/wiki/Poisson_regression) assuming that log(Poisson mean) is linear in the time since the first test of a nuclear weapon by the US on `r nuclearWeaponStates$firstTest[1]`.  We estimate this using [`glm(..., family=poisson)`](https://www.rdocumentation.org/packages/stats/versions/3.6.1/topics/glm).  This model is plausible to the extent that this trend might represent a growing international awareness of the threat represented by nuclear weapons including a hypothesized increasing reluctance of existing nuclear-weapon states to share their technology. The current process of ratifying the [Treaty on the Prohibition of Nuclear Weapons](https://en.wikipedia.org/wiki/Treaty_on_the_Prohibition_of_Nuclear_Weapons) supports the hypothesis of such a trend, while the lack of universal support for it clearly indicates that nuclear proliferation is still likely to continue.  We use this model to extend the 74 years of history of nuclear proliferation available as this is being written `r nukeDataCurrent` into predicting another 74 years into the future. 

# How did the existing nuclear-weapon states develop this capability? 

There are, of course, multiple issues in nuclear proliferation:  a new nuclear-weapon state requires at least four distinct things to produce a nuclear weapon: motivation, money, knowledge, and material.  

## Motivation

Virtually any country that feels threatened would like to have some counterweight against aggression by a potential enemy.  The US funded the Manhattan project believing that Nazi Germany likely had a similar project.  

@Ellsberg:2017 noted that every US president since [Truman (president: 1945-1953)](https://pl.wikipedia.org/wiki/Harry_Truman) considered the use of nuclear weapons.  [With the possible exception of Ford (president: 1974-1977), all threatened to use them, sometimes publicly, sometimes in secret.](https://en.wikipedia.org/wiki/Daniel_Ellsberg#The_Doomsday_Machine) Countries threatened include the Soviet Union (now Russia), the People's Republic of China, Iraq, Iran, Libya, India, and North Korea.^[@Ellsberg:2017.  See also @Wikip:Ellsberg.]  

One might therefore understand the motivation of North Korea to accelerate their nuclear program in the early 2000s after hearing themselves along with Iran and Iraq described as the ["Axis of evil"](https://en.wikipedia.org/wiki/Axis_of_evil) by US President [George W. Bush](https://en.wikipedia.org/wiki/George_W._Bush)^[@Bush:2002;  see also @Wikip:AxisOfEvil.] and after then seeing Iran repeatedly threatened and Iraq invaded with [estimated deaths ranging from over 100,000 to over a million](https://en.wikipedia.org/wiki/Casualties_of_the_Iraq_War)^[For a survey of casualty estimates by many different groups, see 
@Wikip:IraqWar.  The highest serious counts appear to have been @ORB:2008.] out of a population in 2016 of roughly 37 million.  Indeed, any reasonable person might understand the eagerness of North Korean leaders for something that could protect them from similar threats.  

Similar logic might explain why Soviet leaders might have felt a need to defend themselves from nuclear coercion after [having been invaded by the US and over a dozen other countries trying to put the Tsar back in power after World War I](https://en.wikipedia.org/wiki/Allied_intervention_in_the_Russian_Civil_War).^[@Fogelsong:2014.  Many more references can be found in @Wikip:AlliesInRussia.]  The United Kingdom and France likely felt nuclear threats from the Soviet Union.^[The UK and France would have had many reasons to fear the intentions of the USSR during the early period of the [Cold War](https://en.wikipedia.org/wiki/Cold_War):  The first test of a nuclear weapon by the USSR came just over three months after the end of the 1948-49 [Berlin Blockade](https://en.wikipedia.org/wiki/Berlin_Blockade).  Other aspects of Soviet repression in countries they occupied in Eastern Europe contributed to the failed [Hungarian Revolution of 1956](https://en.wikipedia.org/wiki/Hungarian_Revolution_of_1956).]  China faced nuclear threats from the US regarding Korea^[@Pierson:2017.  See also @Wikip:Ellsberg.] and the Taiwan Strait.^[@Halperin:1966.  See also @Wikip:Ellsberg.]  India faced major threats from China, [^India] Pakistan from India,[^Pak] and Israel from its neighbors.[^Israel]

More generally the history of US belicosity includes [invading Canada in 1812](https://www.history.com/news/how-u-s-forces-failed-to-conquer-canada-200-years-ago)^[@Berton:1980 claims that the modern Canadian national identity was forged in the War of 1812.  Casual conversations with Canadians in the 2000s and 2010s have confirmed that this is one issue that still separates Canadians from the US.] and [numerous other foreign interventions](https://en.wikipedia.org/wiki/Foreign_interventions_by_the_United_States) including invading [Afghanistan in 2001](https://en.wikipedia.org/wiki/War_in_Afghanistan_(2001%E2%80%93present)), and [Iraq in 2003](https://en.wikipedia.org/wiki/Iraq_conflict_(2003%E2%80%93present)), plus continued threats against Iran, North Korea, and more recently Venezuela.  This history might help people understand how leaders in many countries may be concerned about their own security if they fail to do what the US demands of them.  The [extra-judicial execution of Osama bin Laden and four others in his household by SEAL Team 6](https://en.wikipedia.org/wiki/Death_of_Osama_bin_Laden) on 2011-05-02 has reportedly increased the risks that a Pakistani nuclear weapon might be stolen by Islamic terrorists intent on retaliating against the US for its interventions in Pakistan and neighboring countries.^[@Cohen:2009;  see also @Borger:2010.] 

\vspace{\baselineskip}
\centerline{\textit{\textbf{The September 11th attacks}}}

\centerline{\textit{\textbf{might have been a mushroom cloud.}}}
\vspace{\baselineskip}

All this suggests that it will be difficult to reduce the threat of nuclear proliferation and nuclear war without somehow changing the nature of international relations so weaker countries have less to fear from the demands of nuclear-weapon states like the US.  

## Money 

It's no accident that most of the world's nuclear-weapon states are large countries with substantial populations and economies.  That's not true of Israel with only roughly 9 million people nor North Korea with roughly 26 million people in 2018.  France and the UK have only about 67 and 68 million people, but they are also among the world leaders in the size of their economies.  

Pakistan is a relatively poor country that that got [secret help from the US in the 1980s in violation of US law to secure Pakistani cooperation with US support for anti-Soviet resistance in Afghanistan](https://www.wilsoncenter.org/publication/new-documents-spotlight-reagan-era-tensions-over-pakistani-nuclear-program).[^Pak2] [Robert Gallucci](https://en.wikipedia.org/wiki/Robert_Gallucci), a special adviser on WMDs to President Clinton, said that the nuclear programs of Iran, Libya and North Korea got US technology from Pakistan, and would not have gotten off the ground without US support for the Pakistani nuclear program.[^KP] 

And now the US is helping Saudi Arabia obtain nuclear power, in spite of (a) the evidence that [the Saudi government including members of the Saudi royal family were involved in preparations for the suicide mass murders of September 11, 2001, at least as early as 1999](https://en.wikipedia.org/wiki/The_28_pages),^[@Graham:2003.  See also @Wikip:28pages.] and (b) their [on-going support for Al Qaeda in Yemen, reported as recently as 2019](https://en.wikipedia.org/wiki/Saudi_Arabian-led_intervention_in_Yemen).^[See, for example, @Bazzi:2019 and @Wikip:SaudiYemen, more generally.] 

## Knowledge

In 1976, [John Aristotle Phillips](https://en.wikipedia.org/wiki/John_Aristotle_Phillips), an "underachieving" undergraduate at Princeton University, "designed a nuclear weapon using publicly available books and papers."^[@Spokane:1976. See also @Wikip:studentBomb.] Nuclear weapons experts disagreed on whether the design would have worked.  Whether Phillips' design would have worked or not, it should be clear that the continuing progress in human understanding of [nuclear physics](https://en.wikipedia.org/wiki/Nuclear_physics) inevitably make it easier for people interested in making such weapons to acquire the knowledge of how to do so.  

That was less true in the 1940s.  After Soviet premier Joseph Stalin learned of the atomic bombings of Hiroshima and Nagasaki, the USSR (now Russia) increased the funding for their nuclear-weapons program.  That program was helped by intelligence gathering about the German nuclear weapon project and the American Manhattan Project.^[@osti:espionage.  See also @wikip:Soviet.]  

## Material 

Reportedly the most difficult part of making nuclear weapons today is obtaining sufficient fissile material.  As noted above, @Toon:2007 said that 32 currently non-nuclear powers had sufficient fissile material in 2003 to make nuclear weapons if they wished. 

## Conclusions regarding motivation, money, knowledge and materials
 
  1. There seems to be no shortage of motivations for other countries to acquire nuclear weapons.  
  
  2. The knowledge and materials required to make such weapons in a relatively short order are also fairly widely available, even without the documented willingness of current nuclear powers to secretly help other countries acquire such weapons in some cases.[^quickNukes]  
  
  3. Unless there is some fundamental change in the structure of international relations, it seems unwise to assume that there will not be more nuclear-weapon states in the future, with the time to the next "first test" of a nuclear weapon following a probability distribution consistent with the previous times between "first tests" of nuclear weapons by the current nuclear-weapon states.  

# Exponential time between Poisson "first tests" 

Possibly the simplest model for something like the time between "first tests" in an application like this is to assume they come from one [exponential distribution](https://en.wikipedia.org/wiki/Exponential_distribution) with 8 observed times between the 9 current nuclear-weapon states plus one [censored observation](https://en.wikipedia.org/wiki/Censoring_(statistics)) of the time between the most recent one and a presumed next one. This simple theory tells us that the maximum likelihood estimate of the mean time between such "first tests" is the total time from the US "Trinity" test to the present, `r round(yrsSinceT <- as.numeric(difftime(nukeDataCurrent, nuclearWeaponStates$firstTest[1], units='days')/365.25), 1)` years, divided by the number of new nuclear-weapon states `r (nNewNucSt <- (nrow(nuclearWeaponStates)-1))`, not counting the first, which had no predicessors.  Conclusion:  Mean time between "first tests" = `r round(yrsSinceT / nNewNucSt, 1)` years.[^WikivTime]  

However, Figure \@ref(fig:plot) suggests that the time between 
"first tests" of succeeding nuclear-weapon states is increasing.  The decreasing hazard suggested by this figure requires mathematics that are not as easy as the censored data estimation as just described. 

To understand the current data better, we redo Figure \@ref(fig:plot) with a log scale on the y axis in Figure \@ref(fig:ploty).   

```{r ploty, fig.cap = "Semilog plot of time between new nuclear-weapon states"}
plotNucStates(log.='y')
```

Figures \@ref(fig:plot) and \@ref(fig:ploty) seem consistent with the following:

- Time between events might be exponentially distributed but with a hazard rate that varies over time.  [Recall that the [hazard rate](https://en.wikipedia.org/wiki/Survival_analysis#Hazard_function_and_cumulative_hazard_function) for the exponential distribution is constant: $h(t) = (-d/dt \log S(t)) = \lambda$, writing the exponential survival function as $S(t) = \exp(-\lambda t)$.]  A non-constant hazard is consistent with the apparent increase in the time to the next "first test" by a new nuclear-weapon state.  
- Even though nuclear proliferation has been slowing since 1950, it could _accelerate_ in the future if more states began to perceive greater threats from other nations.  
- Log hazard that is either linear or decreasing with some higher power of the time since the first test of a nuclear weapon (code-named ["Trinity"](https://en.wikipedia.org/wiki/Trinity_(nuclear_test)))^[@Rhodes:1986.  See also @Wikip:Trinity.] or behaves like a ["Wiener process" (also called a "Brownian motion")](https://en.wikipedia.org/wiki/Wiener_process).^[This stochastic formulation would mean that the variance of the increments in log(hazard) between "first tests" is proportional to the elapsed time.  See @Wolfram:Wiener and @Wikip:Wiener.]  In this article, we model the trend as deterministic and leave consideration of a [Gaussian random walk](https://en.wikipedia.org/wiki/Random_walk) and similar stochastic formulations for future work.[^ranWalk]

Because of the well-known duality between the [exponential distribution](https://en.wikipedia.org/wiki/Exponential_distribution) and the [Poisson distribution](https://en.wikipedia.org/wiki/Poisson_distribution), we can also model this as a series of the number of events each year, month, week, or day.  For present purposes, we will use a series of annual observation.  Changing to monthly, weekly or daily observations might give us slightly better answers while possibly increasing the compute time more than it's worth.  

# Parameter estimation 

For modeling and parameter estimation, we use [`glm(firstTests ~ timeSinceTrinity, poisson)`](https://www.rdocumentation.org/packages/stats/versions/3.6.1/topics/glm) with:   

- `firstTests` = the number of "first tests" of a nuclear-weapon by a new nuclear-weapon state each year, and   
- `timeSinceTrinity` = number of years since 1945-07-16, when the first nuclear weapon was tested, code-named ["Trinity"](https://en.wikipedia.org/wiki/Trinity_(nuclear_test)).  

We use the [`lubridate` package](https://lubridate.tidyverse.org/) for dates.  The first thing we want is the current year.  We get that starting with [`today`](https://www.rdocumentation.org/packages/lubridate/versions/1.7.4/topics/today):  

```{r today}
library(lubridate)
(Today <- today())
```

From this we get the year:  

```{r year}
(currentYear <- year(Today))
```

We include an observation for the current year only if it's more than 6 months since January 1 and since the last "first test".  

```{r currentYear}
if((month(Today)<7) || 
   (difftime(Today, 
          tail(nuclearWeaponStates$firstTest, 1), 
          units = 'days')<(366/2)))
      currentYear <- (year(Today)-1)
```

Start after the year of the first test of a nuclear weapon.  

```{r firstYear}
firstTstYr <- year(nuclearWeaponStates$firstTest)
(firstYear <- firstTstYr[1])
```

We use this to create a vector of the number of `firstTest`s by year and put this a `tibble` with `Year`.  

```{r firstTests}
(nYrs <- currentYear - firstYear)
firstTests <- ts(rep(0, nYrs), firstYear+1)
firstTstYrSinceFirst <- firstTstYr - firstYear
firstTests[firstTstYrSinceFirst] <- 1

library(tibble)
(FirstTsts <- tibble(Year=time(firstTests), 
      nFirstTests=firstTests))
```

We add `ctry` to this `tibble` for future reference.  

```{r firstCtry}
Ctry <- rep('', nYrs)
Ctry[firstTstYrSinceFirst] <- 
        nuclearWeaponStates$ctry[-1]
FirstTests <- cbind(FirstTsts, ctry=Ctry)
```

We add `timeSinceTrinity`, which we will use in modeling.    

```{r timeSince}
FirstTests$timeSinceTrinity <- 1:nYrs
```

We then fit a model with log(Poisson mean number of first tests each year) linear in `timeSinceTrinity`.  

```{r fit1}
summary(fitProlif1 <- glm(
  firstTests ~ timeSinceTrinity, 
  poisson, FirstTests))
```

This says that the time trend visible in Figures \@ref(fig:plot) and \@ref(fig:ploty) is not statistically significant.  

[George Box](https://en.wikipedia.org/wiki/George_E._P._Box) famously said that, ["All models are wrong, but some are useful."](https://en.wikipedia.org/wiki/All_models_are_wrong#Historical_antecedents)^[@BoxDraper:1987;  @Wikip:ModelsWrong.] 

@Burnham:1998 and others claim that better predictions can generally be obtained using Bayesian Model Averaging.^[See also @Raftery:1995 and @Claeskens:2008.] In this case, we have two models:  `log(Poisson mean)` being constant or linear in `timeSinceTrinity`.  The [`bic.glm`](http://finzi.psych.upenn.edu/R/library/BMA/html/bic.glm.html) function in the [`BMA`](http://finzi.psych.upenn.edu/R/library/BMA/html/bic.glm.html) package can estimate these two models and compute posterior probabilities.    

```{r BMA}
library(BMA)
fitProlif <- bic.glm(
  FirstTests['timeSinceTrinity'], 
  FirstTests$nFirstTests, 
  "poisson")
summary(fitProlif)
```

It is standard in the BMA literature to assume an approximate uniform distribution over all models considered with a penalty for estimating each additional parameter to correct for the tendancy of the models to overfit the data.  With these standard assumptions, this comparison of these two models estimates a `r round(100*fitProlif$postprob[2])` percent posterior probability for the model linear in  `timeSinceTrinity`, leaving `r round(100*fitProlif$postprob[1])` percent probability for the model with a constant Poisson mean.  Figure \@ref(fig:plotyf) adds these lines to Figure \@ref(fig:ploty).

```{r plotyf, fig.cap = "BMA fit to time between new nuclear-weapon states"}
plotNucStates(log.='y')

predProlif <- with(fitProlif, 
    outer(rep(1, nYrs+1), mle[, 1]) + 
    outer(0:nYrs, mle[, 2]))
lgnd <- paste0(c('constant', 'linear'), 
    ' (', 100*round(fitProlif$postprob, 2), '%)')
firstTest_nYrs <- as.Date(paste0(
  trunc(nuclearWeaponStates$firstTestYr[1])+0:nYrs, 
  '-07-01') )
matlines(firstTest_nYrs, exp(-predProlif), 
         lty=c('dashed', 'dotted'), 
         col=c('red', 'blue'))
legend('topleft', lty=c('dashed', 'dotted'), 
     col=c('red', 'blue'), lgnd, 
     bty='n')
```

The lines in this figure seem higher than the mean of the points and a linear trend through the points.  This bias might be explained by the difference between ordinary least squares and `glm` used in this case.

It's well known that extrapolation is problematic.  Bayesian Model Averaging offers on average more plausible predictions than using a single model.  Before proceeding, let's consider this same BMA fit with quadratic, cubic, and quartic terms.

```{r fit23}
FirstTests$time2 <- (1:nYrs)^2
FirstTests$time3 <- (1:nYrs)^3
FirstTests$time4 <- (1:nYrs)^4
FirstTests$time5 <- (1:nYrs)^5
fitProlif4 <- bic.glm(
  FirstTests[4:7], FirstTests$nFirstTests, "poisson")
fitProlif4$postprob
fitProlif4$mle
fitProlif5 <- try(bic.glm(
  FirstTests[4:8], FirstTests$nFirstTests, "poisson"))
```

When quadratic, cubic and quartic terms are considered, the `BMA:::bic.glm` algorithm keeps only the highest order term, and their regression coefficients are all negative.  This means that the the Poisson probability as a function of `timeSinceTrinity` for each model in the Bayesian Model Average declines as `timeSinceTrinity` increases, except (obviously) for the constant model. When a fifth order term is included, the model is computationally singular.  Both these resuts make some sense, as there are only 8 years with one "first test";  all the others have zero "first tests", and no year had more than one.  

We add the extra lines of `fitProlif4` to Figure \@ref(fig:plotyf) to get Figure \@ref(fig:ploty4).

```{r ploty4, fig.cap = "BMA quartic fit to time between new nuclear-weapon states"}
plotNucStates(log.='y')

predProlif4 <- matrix(NA, nYrs+1, 5)
predProlif4[, 1] <- fitProlif4$mle[1,1]
for(pwr in 1:4){
  predProlif4[, pwr+1] <- with(fitProlif4, 
      mle[pwr+1, 1] + ((0:nYrs)^pwr)* 
      fitProlif4$mle[pwr+1, pwr+1])
}
lgnd4 <- paste0(c('constant', 'linear', 'quadratic', 
        'cubic', 'quartic'), 
    ' (', 100*round(fitProlif4$postprob, 4), '%)')
matlines(firstTest_nYrs, exp(-predProlif4), 
         lty=1:5, col=1:5)
legend('topleft', lty=1:5, col=1:5, lgnd4, 
     bty='n', cex=0.95)
```

Comparing predictions between `fitProlif` and `fitProlif4` might help us understand better the limits of what we can learn from the available data.  

Next, we compute here central 80 percent confidence, prediction, and (0.8, 0.8) tolerance intervals for future nuclear proliferation based on fitProlif and fitProlif4.  [["Confidence intervals"](https://en.wikipedia.org/wiki/Confidence_interval) bound the predicted mean number of nuclear-weapon states for each future year considered.  Central 80 percent ["prediction intervals"](https://en.wikipedia.org/wiki/Prediction_interval) are limits that include the central 80 percent of distribution of the number of nuclear-weapon states.  They add the uncertainty in the modeled Poisson process to the uncertainty of estimating the mean of that process for each future year considered.  We will also compute
(0.8, 0.8) ["tolerance intervals"](https://en.wikipedia.org/wiki/Tolerance_interval#Relation_to_other_intervals); $(p, 1-\alpha)$ tolerance intervals have a probability of $(1-\alpha)$ of containing a proportion of at least $p$ of all future observations.] 

# Confidence limits    
  
We start by computing `nSims` simulated Poisson mean numbers of "first tests" by new nuclear-weapon states for each of the `nYrs` years used in `fitProlif` and `fitProlif4` and another `nYrs` years beyond.  These simulations will later be used to compute confidence limits for the model fit and prediction and tolerance limits for the actual number of nuclear-weapon states.  

```{r meanSims}
nSims <- 5000
timeSncT <- 1:(2*nYrs)
pastfut <- tibble(Year=firstYear+timeSncT, 
                 timeSinceTrinity=timeSncT, 
                 time2=timeSncT^2, time3=timeSncT^3, 
                 time4=timeSncT^4)
library(Ecfun)
simMeans <- simulate(fitProlif, nSims, seed=3, 
    newdata=pastfut[2], type='response')
dim(simMeans)

# earlier simulations showed a curve 
# for the mean of simMeans4 that 
# that was quite extreme. 
# Check it by set.seed(1) here
# and 2, 3, ... later
simMeans4 <- simulate(fitProlif4, nSims, seed=1, 
    newdata=pastfut[2:5], type='response')
dim(simMeans4)
```

We invert these simulated Poisson means to get simulated exponential times, then summarize them in a format compatible with `yearsSinceLastFirstTest` in `nuclearWeaponStates`. 

```{r expSum}
sumSims <- function(x, Year=pastfut$Year){
##
## return data.frame of Year with 
## mean and (.1, .5, .9) quantiles of x
## 
  Yr <- as.Date(paste0(Year, '-07-01'))
  xMean <- apply(x, 1, mean)
  xCI <- apply(x, 1, quantile, 
                  probs=c(.1, .5, .9))
# fix names
  rownames(xCI) <- c('L10', 'median', 'U10') 
  xSum <- data.frame(Year=Yr, 
        mean=xMean, data.frame(t(xCI)))
  xSum
}
sumExpMeans <- sumSims(1/simMeans)
sumExpMeans4 <- sumSims(1/simMeans4)
```

These numbers are added to Figure \@ref(fig:ploty) to produce Figures \@ref(fig:plotfut) and \@ref(fig:plotfu4).  

```{r plotfut, fig.cap = 'Estimated mean time between "first tests," past and future'}
plotNucStatesPred <- function(x, ...){
##
## plotNucStates with future predictions 
## summarized in x   
##  
  xlim. <- range(x$Year)
  ylim. <- range(nuclearWeaponStates$yearsSinceLastFirstTest, 
      head(x[-1], 1), tail(x[-1], 1), na.rm=TRUE)
  
  plotNucStates(xlim.=xlim., ylim.=ylim., log.='y', ...)
  with(x, lines(Year, mean))
  with(x, lines(Year, median, lty='dashed', col='blue'))
  with(x, lines(Year, U10, lty='dotted', col='red'))
  with(x, lines(Year, L10, lty='dotted', col='red'))
  legend('topleft', c('80% confidence limits for the mean', 
          'mean', 'median'),
      col=c('red', 'black', 'blue'), 
      lty=c('dotted', 'solid', 'dashed'), bty='n')
  abline(h=200, lty='dotted', col='grey')
}
plotNucStatesPred(sumExpMeans)
```

The fairly flat shape of the median and lower 10 percent lines in Figure \@ref(fig:plotfut) seem consistent with a model that is `r 100*round(fitProlif$postprob[1], 2)` percent constant and `r 100*round(fitProlif$postprob[2], 2)` percent linear on the log scale, reported with `summary(fitProlif)` above.  The substantial curvature of the solid line forecast looks hopeful, with a mean of simulated means being almost 200 years between successive "first tests" by new nuclear-weapon states by the end of the forecasted period, `r year(tail(sumExpMeans$Year, 1))`.  

The fact that the mean of the simulations exceeds the upper confidence limit for `r year(tail(sumExpMeans$Year, 1))` seems odd but can be explained by noting that this is a mixture with a smaller component being positively skewed with a mean substantially larger than the more common component.  To understand this consider a toy example 

$$
X = PX_1+(1-P)X_2
$$ 

with the random variable $P$ being either 0 or 1 with E$P$ = $p$, $X_i$ being lognormal with mean and standard deviation of the logarithms being $\mu_i$ and $\sigma_i$, respectively, and with $P$ and $X_i$, $i$ = 1, 2, being independent of one another.  Consider the further simplification with $\mu_1$ = 0 = $\sigma_1$.  Then the ($1-p/2$) upper limit for $X$ is the median of the second component, $\exp(\mu_2)$, while E$X = (1-p)\exp(\mu_2 + \sigma^2_2/2)$.  Then the mean is greater than this upper limit whenever $(1-p)\exp(\sigma^2_2/2)$ > 1, which will be true if $\sigma_2 > \sqrt{-2\log(1-p)}$.  The case considered here is more complicated than this toy example, but the same principle applies.  

Note further that the distribution for each year in Figure \@ref(fig:plotfut) is a mixture of lognormal distributions, which means that their reciprocals, the mean numbers of "first tests" each year, will also be a mixture of lognormals with the same standard deviations on the log scale.  This standard deviation is larger the farther we extrapolate into the future.  

```{r plotfu4, fig.cap = 'Estimated mean time between "first tests" considering up to a quartic model'}
plotNucStatesPred(sumExpMeans4)
```

The increase over time in the _mean_ time between "first tests" in Figures \@ref(fig:plotfut) and \@ref(fig:plotfu4) suggests a desirable decrease in the rate of nuclear proliferation.  

However, we are more concerned with the shorter times between "first tests", and they seem all too probable, as we shall see when we simulate and `cumsum` them.  To do that, we append these simulated predictions to a plot of the evolution of the number of nuclear-weapon states through the historical period.^[In these simulations, we assume a zero probability of a nuclear power giving up their nuclear weapons, even though [South Africa reportedly discontinued their nuclear weapons program in 1989](https://en.wikipedia.org/wiki/South_Africa_and_weapons_of_mass_destruction), prior to its [first universal elections in 1994](https://en.wikipedia.org/wiki/South_Africa#End_of_apartheid).  We could potentially add South Africa to `nuclearWeaponStates` with the same date as Israel, then model the distribution of the time to when a nuclear-weapon state gives up its nuclear weapons using an exponential distribution.  For that, we have one observed time and eight such times that are censored.  Standard theory in that case says that the maximum likelihood estimate of the mean time to relinquishing nuclear weapons assuming an exponential distribution is the sum of all the times, censored or observed, divided by the number of times observed, not including the censored times in the denominator. For purposes of illustration, we will assume that South Africa dismanteled its nuclear weapons 1989-12-31, though a report of an inspection by the  International Atomic Energy Agency dated 1994-08-19 said they had dismantled six nuclear weapons and were still working to dismantle one more.  Based on this, the estimated mean lifetime of a nuclear-weapon state can be estimated at `r round(as.numeric(difftime(Today, as.Date('1979-09-22'), units='weeks') + sum(difftime(Today, nuclearWeaponStates$firstTest, units='weeks')))/52)` years.  We could potentially add this to the current modeling effort, but it would not likely change the answers enough to justify the additional effort.]

```{r cumsum}
str(cumMeans <- apply(simMeans[-(1:nYrs), ], 
                              2, cumsum))
quantile(cumMeans[nYrs,])
(nNucStates <- nrow(nuclearWeaponStates))
str(cumCI <- sumSims(
    nNucStates+rbind(0, cumMeans), 
    pastfut$Year[-(1:(nYrs-1))]))
```

These numbers are plotted in Figure \@ref(fig:plotcum). 

```{r plotcum, fig.cap = "Number of nuclear-weapon states, past and predicted mean"}
plotNNucStates <- function(xfuture, 
        xpast=nuclearWeaponStates, ...){       
##
## plot stairsteps for xpast and lines for xfuture
## with either 5 or 7 columns in xfuture  
##
  xlim. <- c(xpast$firstTest[1], tail(xfuture$Year, 1))
  nColsFut <- length(xfuture)
  ylim. <- c(0, tail(xfuture[[nColsFut]], 1))
  
  plot(xlim., ylim., type='n', xlab='', ylab='', las=1, 
     bty='n')
##
## 1.  plot xpast
##  
  fT_date <- c(xpast$firstTest[1], 
      xpast$firstTest, Today)
  lines(fT_date, 
      c(0:nNucStates, nNucStates), type='s')
  abline(v=NPTdate, lty='dashed', col='grey')
# abline(h=20)  
  xlim20. <- c(xlim.[1]-7*365, xlim.[1])
  lines(xlim20., rep(20, 2), lty='dashed', col='grey', 
        xpd=NA)
  xlim20 <- c(as.Date('1980-01-01'), xlim.[2])
  lines(xlim20, rep(20, 2), lty='dashed', col='grey')
#  
  ymid <- mean(ylim.)
  text(NPTdate-.017*diff(xlim.), 
       ymid, 'NPT', col='grey', srt=90)  
##
## 2.  plot xfuture 
##
  with(xfuture, lines(Year, mean))
  with(xfuture, lines(Year, median, lty='dashed', col='blue'))
  with(xfuture, lines(Year, U10, lty='dotted', col='red'))
  with(xfuture, lines(Year, L10, lty='dotted', col='red'))
  ncols <- 3
  leg <- c('80% confidence limits for the mean', 'mean', 'median')
  col. <- c('red', 'black', 'blue')
#  
  if('predU10' %in% names(xfuture)){
    leg <- c(leg, '80% prediction limits')
    col. <- c(col., 'green')
    with(xfuture, lines(Year, predU10, lty='dashed', 
              col='green', lwd=2))
    with(xfuture, lines(Year, predL10, lty='dashed', 
              col='green', lwd=2))
    ncols <- 4
  }
  if('tolU10' %in% names(xfuture)){
    leg <- c(leg, '(0.8, 0.8) tolerance limits')
    col. <- c(col., 'purple')
    with(xfuture, lines(Year, tolU10, lty='dashed', 
              col='purple', lwd=2))
    with(xfuture, lines(Year, tolL10, lty='dashed', 
              col='purple', lwd=2))
    ncols <- ncols+1
  }
##
## 3.  legend
##  
  lty. <- c('dotted', 'solid', rep('dashed', 3))
  lwd. <- c(rep(1, 3), 2, 2)
#    
  legend('topleft', leg[1:ncols], col=col.[1:ncols], 
         lty=lty.[1:ncols], lwd=lwd., bty='n')
}
plotNNucStates(cumCI)
```  
  
The slopes of the mean and median lines are steeper than the recent history, but the statistical evidence does not support the naive interpretation of a slowing in nuclear proliferation that one might get from considering only the most recent data.  

We repeat this analysis with the quartic BMA mixture in Figure \@ref(fig:plotcum4). 

```{r plotcum4, fig.cap = "Number of nuclear-weapon states, past and predicted mean, BMA quartic fit"}
str(cumMeans4 <- apply(simMeans4[-(1:nYrs), ], 
                              2, cumsum))
quantile(cumMeans4[nYrs,])
str(cumCI4 <- sumSims(
    nNucStates+rbind(0, cumMeans4), 
    pastfut$Year[-(1:(nYrs-1))]))

plotNNucStates(cumCI4)
```  

Comparing Figures \@ref(fig:plotcum) and \@ref(fig:plotcum4) shows that the higher order terms in the quartic BMA mixture widens the confidence limits, making the 10th percentile essentially flat with almost no additional nuclear proliferation, while the mean quickly escapes the upper limit.  That sharply rising mean suggests that less than 10 percent of the simulations predict nuclear arms races that involve many nation states and many more non-state armed groups.  These outcomes are not likely, but the probabilities of such outcomes seem too large to be considered negligible, especially when gambling with the future of civilization, as we are if we fail to take aggressive action to deal with this threat.  

We replicate the production of cumCI4 to see how stable the numbers are for the final year in Figures \@ref(fig:plotcum) and \@ref(fig:plotcum4), starting with what we have.  

```{r qq4, fig.cap = "Lognormal probability plot of mean numbers of nuclear-weapon states per the quartic mixture model in the last simulated year"}
cumCI2 <- rbind(tail(cumCI, 1), tail(cumCI4, 1))
rownames(cumCI2) <- c('BMA2', 'BMA4')

for(i in 2:10){
  simMeans4b <- simulate(fitProlif4, nSims, seed=i, 
      newdata=pastfut[2:5], type='response')
  cumMeans4b <- apply(simMeans4b[-(1:nYrs), ], 
                              2, cumsum)
  cumCI4b <- sumSims(
    nNucStates+rbind(0, cumMeans4b), 
    pastfut$Year[-(1:(nYrs-1))])
  cumCI2 <- rbind(cumCI2, tail(cumCI4b, 1))
  rownames(cumCI2)[i+1] <- paste0(
    'BMA4', letters[i])
}

qqCI2 <- as.data.frame(
  qqnorm(cumCI2$mean[-1], datax=TRUE, 
       log='x', ylab='simulated mean'))
with(qqCI2[1, , drop=FALSE], 
     points(x, y, pch=15))
with(qqCI2[1, , drop=FALSE], 
     text(x, y, adj=c(0, 0.5), 
          '  <- used in other figures'))
cumCI2
```

These replications establish that the simulated `mean` number of nuclear-weapon states in the last simulated year, `r year(tail(cumCI$Year, 1))`, in Figure \@ref(fig:plotcum4) is _not_ a complete outlier.  

Beyond that, comparing Figures \@ref(fig:plotcum) and \@ref(fig:plotcum4) establishes that the median and lower limit are lower for the quartic BMA mixture while the upper limit is slightly higher, and the mean for the quartic BMA mixture is too large to be credible.  

Even ignoring the simulations of uncontrolled nuclear arms races, the median lines in Figures \@ref(fig:plotcum) and \@ref(fig:plotcum4) predict between `r round(tail(cumCI, 1)$median, 1)` and `r round(tail(cumCI4, 1)$median, 1)` at the end of the current simulated period, `r year(tail(cumCI, 1)$Year)`, which is within the anticipated lifespan of a substantial portion of babies born today.  Those _median_ numbers are a little less than double the number of nuclear-weapon states today.  

We extend this analysis by adding prediction intervals to these plots.  

# Prediction limits

The simplest bounds on the future are [prediction intervals](https://en.wikipedia.org/wiki/Prediction_interval), which combine the statistical uncertainty in the estimates of mean numbers of nuclear-weapon states with the random variability in the outcomes.  For this we use `rpois(., simMeanNucStByYr)`.  

```{r simNew}
set.seed(9)
rpois. <- function(n, lambda){
## 
## Some of the means are so large that 
## rpois sometimes returns NAs.  
## Avoid this by outputting numerics
## rather than integers in those cases.
## NOTE:  This was discussed on 
## r-devel@r-project.org 2020-01-19 and 20
## with the tentative conclusion that 
## a change such as documented here 
## might be implemented in a future version
## of R.  If that happens, this 
## function will no longer be needed.  
##  
      n2 <- max(n, length(lambda))
      n. <- rep_len(n, n2)
      lam <- rep_len(lambda, n2)
#  If Poisson mean = 0.9*.Machine$integer.max, 
#  an observation would have to be over 
#  4600 standard deviations above the mean 
#  to generate an error.        
      big <- (lam>0.9*.Machine$integer.max)
      out <- rep(NA, n2)
      out[big] <- round(rnorm(sum(big), 
                  lam[big], sqrt(lam[big])))
      out[!big] <- rpois(sum(!big), lam[!big])
      out
}
cumsumPred <- function(x, ...){
##
## cumsum of rpois predictions based on x
##  
#  
  simPred <- data.frame(lapply(
      x[-(1:nYrs),], rpois., n=nYrs))
  cumPred <- data.frame(lapply(
      simPred, cumsum))
  cumPred
}
cumPred <- cumsumPred(simMeans)

cumsumC.PI <- function(cumsumPred, cumsumCI, ...){
  cumPI <- sumSims(  
      nNucStates+rbind(0, cumsumPred),
      pastfut$Year[-(1:(nYrs-1))])
  names(cumPI)[c(3, 5)] <- paste0('pred', 
                            c('L', 'U'), 10)
  cumC.PI <- cbind(cumsumCI, cumPI[c(3, 5)])
  cumC.PI
}
cumC.PI <- cumsumC.PI(cumPred, cumCI)
```

We add this to the image in Figure \@ref(fig:plotcum) to create Figure \@ref(fig:plotPred).    

```{r plotPred, fig.cap = "Number of nuclear-weapon states, past and predicted"}
plotNNucStates(xfuture=cumC.PI)       
```  

We do the same for the quartic BMA model in Figure \@ref(fig:plotcum4) to produce Figure \@ref(fig:plotPred4).  In both Figures \@ref(fig:plotPred) and \@ref(fig:plotPred4) the most likely scenarios, especially the median line and the space more generally between the 80 percent confidence limits, predict a continuation of nuclear proliferation.  It's difficult to imagine how that could continue without also substantively increasing the risk of nuclear war and therefore also of the extinction of civilization.  

```{r plotPred4, fig.cap = "Number of nuclear-weapon states, past and predicted per quartic BMA model"}
cumPred4 <- cumsumPred(simMeans4)
cumC.PI4 <- cumsumC.PI(cumPred4, cumCI4)
plotNNucStates(xfuture=cumC.PI4)       
```

We also plot the probability distribution of further nuclear proliferation by summarizing `cumPred` in Figure \@ref(fig:prolif).    

```{r prolif, fig.cap = "Probability distribution of the  time to the next 1:5 new nuclear-weapon states"}
plotProbs <- function(x, label_year=2050, ...){ 
# adj.=matrix(c(.53, -.4, .55, 1.15), 2, byrow=TRUE), ...){ 
##
## Probability distribution of the next 1:5 
## new nuclear-weapon states 
##
## from x = cumPred, a data.frame
##  
  maxNewNucSt <- 5
  probs <- function(x, n=maxNewNucSt){
    p <- colMeans(outer(x, 0:(n-1), '>'))
    p
  }
  probProlif. <- apply(as.matrix(x), 1, probs)
  probProlif <- ts(t(probProlif.), 
                     currentYear+1)
  colnames(probProlif) <- 1:maxNewNucSt
  ylims <- probProlif.[c(1, maxNewNucSt), c(1, nYrs)]
  midLine <- round(mean(ylims[c(1, 4)]), 2)
  matplot(time(probProlif), probProlif, 
        type='l', xlab='', las=1, ylab='', 
        ...)
  abline(h=midLine, lty='dotted', ...)
#  
  midTime <- rep(NA, maxNewNucSt)
  for(i in 1:maxNewNucSt){
    it <- min(which(probProlif[,i]>=midLine))
#    cat(time(probProlif)[it], '')
    midTime[i] <- time(probProlif)[it]
    text(midTime[i], midLine, 
       paste0(midTime[i], '\n', i))
  }
  text(currentYear+0.95*nYrs, midLine, 
       paste0('p =\n', midLine) )
# lable_year
  abline(v=label_year, lty='dotted')
  iyr <- which(time(probProlif) == label_year)
  label_p <- probProlif[iyr, ]
  lines(time(probProlif)[c(1, iyr)], 
        rep(label_p[1], 2), lty='dotted', ...)
  text(time(probProlif)[1+iyr/4], label_p[1],
    paste0('p =\n', round(label_p[1], 2), ...) )
#
  list(midLine=midLine, midTime=midTime, 
       probProlif=probProlif, 
       label_year=c(label_year=label_year, 
                    label_prob=label_p))
}
probProlif <- plotProbs(cumPred)
```

Figure \@ref(fig:prolif) says there is a `r round(100*max(probProlif$probProlif))` percent chance of another nuclear-weapon state by `r tail(time(probProlif$probProlif), 1)` with a `r 100*probProlif$midLine` percent chance of at least 1 by `r probProlif$midTime[1]`.  

We replicate Figure \@ref(fig:prolif) for the quartic BMA model in Figure \@ref(fig:prolif4).

```{r prolif4, fig.cap = "Probability distribution of the  time to the next 1:5 new nuclear-weapon states using the quartic BMA model"}
probProlif4 <- plotProbs(cumPred4)
```

The quartic BMA model summarized in Figure \@ref(fig:prolif4) is more optimistic than the constant-linear BMA model summarized in Figure \@ref(fig:prolif):  The estimated probability of one more nuclear-weapon state by 2050 drops from `r round(window(probProlif$probProlif, 2050, 2050)[,1], 2)` for the constant-linear mixture to `r round(window(probProlif4$probProlif, 2050, 2050)[,1], 2)` for the quartic BMA model.  However, the conclusions from even this more optimistic model remain the same:  

\vspace{\baselineskip}
\centerline{\textit{\textbf{The current structure of international relations}}}

\centerline{\textit{\textbf{threatens the extinction of civilization.}}}
\vspace{\baselineskip}

To better quantify the uncertainty in modeling, we next construct tolerance intervals for the time to the next new nuclear-weapon state.  

# Tolerance limits

We want to add tolerance rather then prediction limits to Figures \@ref(fig:plotcum) and \@ref(fig:plotcum4).  To do this, we add `rpois` simulations to the limits in those figures, rather than `rpois` simulations all the background simulations used to construct Figures \@ref(fig:plotcum) and \@ref(fig:plotcum4).  

```{r simTol}
cumsumTol <- function(x=cumCI, ...){
##
## cumsum of rpois predictions based on x
##  
#  
  simTolU. <- rpois.(nSims*nYrs, diff(x$U10))
  simTolU <- matrix(rpois.(nSims*nYrs, 
                    diff(x$U10)), nYrs)
  simTolL <- matrix(rpois.(nSims*nYrs, 
                    diff(x$L10)), nYrs)
#  
  cumTolU <- apply(simTolU, 2, cumsum)
  cumTolL <- apply(simTolL, 2, cumsum)
#
  cumTolU10 <- apply(cumTolU, 1, quantile, probs=0.9)
  cumTolL10 <- apply(cumTolL, 1, quantile, probs=0.1)
#    
  x$tolL10 <- (nNucStates + c(0, cumTolL10))
  x$tolU10 <- (nNucStates + c(0, cumTolU10))
#
  as.data.frame(x)
}
cumTol <- cumsumTol(cumC.PI)
```

```{r plotTol, fig.cap = "Number of nuclear-weapon states, past and predicted"}
plotNNucStates(cumTol)
```

The upper limit line in Figure \@ref(fig:plotTol) is higher than that in \@ref(fig:plotcum).  It gives us a bit more humility regarding the value of current knowledge.  However, the difference is not enough to substantively alter our conclusions, namely that nuclear proliferation is likely and should not be ignored.  

Do we get the same considering the quartic BMA model?  

```{r plotTol4, fig.cap = "Number of nuclear-weapon states, past and predicted per quartic BMA model"}
cumTol4 <- cumsumTol(cumC.PI4)
plotNNucStates(cumTol4)
```

Indeed, the conclusion from Figure \@ref(fig:plotTol4) is the same as before: Nuclear proliferation is likely to continue until something makes it impossible for anyone to make more nuclear weapons for a very long time.  This will either happen as a result of (a) a nuclear war leading to the destruction of civilization or (b) a major and unprecidented political movement that strengthens international law to the point that the poor, weak, and disfranchised have effective judicial redress for grievances.  

# THE END?  

DOUG SAMUELSON and others:  My current thought is to end this paper at this point and delete the next section.  I may want to retain the appendix and use it to document the production of figures used in a Wikiversity article summarizing these results.  

# Predictions per the linear-only model 

This image may seem too pessimistic to be credible if we believe that the rate of nuclear proliferation will continue to decline, as suggested by Figures \@ref(fig:plot) through \@ref(fig:plotPred) above.  However, that decline was not statistically significant in the `glm` model `fitProlif1` above.  This encouraged us to use Bayesian Model Averaging (BMA), which placed more weight on the constant model.

One way to get more optimistic estimates is to pretend that the model `fitProlif1` above has 100 percent posterior probability rather than the mere `r round(fitProlif$postprob[2], 2)*100` percent computed with `fitProlif`.  We next look at what that estimates for future nuclear proliferation.  

We want analogues to Figures \@ref(fig:plotfut), \@ref(fig:plotPred), and \@ref(fig:prolif), as summarized in the following table.    

```{r TableOfFigs, fig.cap = "Predictions per Bayesian Model Averaging and linear-only models"}
tabOfFigs <- data.frame(Function=
      c('', 'plotNucStatesPred', 'plotNNucStates', 
        'plotProbs'), 
    BMA=c('Figure (data)', '4 (sumExpMeans)', 
          '6 (cumC.PI)', '7 (cumPred)'), 
    glm=c('Figure (data)', '8 (sumExpMeans1)', 
          '9 (cumC.PI1)', '10 (cumPred1)'))
names(tabOfFigs)[1] <- 'function'
rownames(tabOfFigs) <- c('', 
   'Estimated mean time between "first tests"', 
   'Number of nuclear-weapon states', 
   paste("dist'n of time to", 
         'more nuc-weapon states') )
knitr::kable(tabOfFigs)
```

\vspace{\baselineskip}
As before, we use simulations.  

```{r PoissonLin}
simMeans1 <- simulate(fitProlif1, nSims, seed=3, 
    newdata=pastfut['timeSinceTrinity'], type='response')
```

These numbers are added to Figure \@ref(fig:ploty) to produce Figure \@ref(fig:plotfut1), comparable to Figure \@ref(fig:plotfut), assuming the linear model had 100 percent of the posterior probability, not just `r round(fitProlif$postprob[2], 2)*100` percent.  

```{r plotfut1, fig.cap = 'Estimated mean time between "first tests" with log-linear model'}
sumExpMeans1 <- sumSims(1/simMeans1)

op <- par(mar=c(5,5,4,2))
plotNucStatesPred(sumExpMeans1, line_mtext=c(3, 3))
par(op)
```

This model intuitively seems more consistent with the data than the BMA model.  However, to find it plausible, we need to to believe other information we have about nuclear proliferation beyond the estimates of uncertainty documented in the BMA model, `fitProlif`.  

We similary modify Figure \@ref(fig:plotPred) to produce Figure \@ref(fig:plotPred1).  

```{r plotPred1, fig.cap = 'Number of nuclear-weapon states, past and predicted with the glm model'}
cumPred1 <- cumsumPred(simMeans1)

str(cumMeans1 <- apply(simMeans1[-(1:nYrs), ], 
                              2, cumsum))

str(cumCI1 <- sumSims(
    nNucStates+rbind(0, cumMeans1), 
    pastfut$Year[-(1:(nYrs-1))]))

cumC.PI1 <- cumsumC.PI(cumPred1, cumCI1)
plotNNucStates(xfuture=cumC.PI1)
```

We also sumarize the probability distribution of the time to more nuclear-weapon states in Figure \@ref(fig:prolif1), similar to Figure \@ref(fig:prolif).  

```{r prolif1, fig.cap='Probability distribution of the time to more nuclear-weapon states per glm model'}
probProlif1 <- plotProbs(cumPred1)
```

As expected Figures \@ref(fig:plotfut1), \@ref(fig:plotPred1), and \@ref(fig:prolif1) provide a more optimistic image than the comparable Figures \@ref(fig:plotfut), \@ref(fig:plotPred), and \@ref(fig:prolif).  The estimated probability of at least one more nuclear-weapon state by the end of the forecast period, `r tail(time(probProlif1$probProlif), 1)`, dropped from `r round(max(probProlif$probProlif)*100)` percent in Figure \@ref(fig:prolif) to `r round(max(probProlif1$probProlif)*100)` percent in Figure \@ref(fig:prolif1).  Not surprisingly, the probability distributions associated with all aspects of nuclear proliferation are more optimistic with the single `glm` model, `fitProlif1`, than the comparable `BMA` model, `fitProlif`.  

However, to believe the more optimistic analysis, we must use evidence beyond what's in the data.  

The safest policy may be to believe that the reality is someplace in between.  At any event, it seems unwise to pretend that the future will likely be better than the more optimistic scenario provided by `fitProlif1` and the accompanying Figures \@ref(fig:plotfut1), \@ref(fig:plotPred1), and \@ref(fig:prolif1) -- unless we actually see an international de-nuclearization movement with momentum far beyond what we currently see with the [International Campaign to Abolish Nuclear Weapons (ICAN)](https://en.wikipedia.org/wiki/International_Campaign_to_Abolish_Nuclear_Weapons), the United Nations [Treaty on the Prohibition of Nuclear Weapons](https://en.wikipedia.org/wiki/Treaty_on_the_Prohibition_of_Nuclear_Weapons), and related efforts.   

# Discussion 

A growing number of leading figures have said that as long as the world maintains large nuclear arsenals, it is only a matter of time before there is a nuclear war.  Concerns like this have been expressed by two former US Secretaries of Defense ([Robert McNamara](https://en.wikipedia.org/wiki/Robert_McNamara)^[@McNamara:2003] and [William Perry](https://en.wikipedia.org/wiki/William_Perry)), two former US Secretaries of State ([Henry Kissinger](https://en.wikipedia.org/wiki/Henry_Kissinger) and [George Schultz](https://en.wikipedia.org/wiki/George_Shultz)), former US Senator [Sam Nunn](https://en.wikipedia.org/wiki/Sam_Nunn),^[@Shultz:2019] and others with, for example, the [Nuclear Threat Initiative](https://en.wikipedia.org/wiki/Nuclear_Threat_Initiative). [Daniel Ellsberg](https://en.wikipedia.org/wiki/Daniel_Ellsberg) has said that a nuclear war will most likely generate a nuclear winter that lasts several years during which 98 percent of humanity will starve to death if they do not die of something else sooner.^[@Ellsberg:2017b] 

Banerjee and Duflo, two of the three who won the 2019 Nobel Memorial Prize in Economics, have noted that neither economic nor political stability are assured for any country, including the United States, China and India.  In particular, they predict that economic growth will almost certainly slow substantailly in the latter two, leaving many poor people in desparate economic straits.^[@Banerjee:2019] Various journalists and academic researchers remind us that President Trump has demonized various different groups and promoted an increase in ethnic violence.  He refused in 2016 and has continued to refuse to say if he would accept the results of an election if he lost in 2020.^[Klaas:2019] Internal problems in the US, China, India or any other nuclear-weapon state could push political leaders to pursue increasingly risky foreign adventures, like Argentina did in 1982,^[@Wikip:Faulklands] possibly leading to a war that could produce nuclear Armageddon.   

The present work only increases the urgency of limiting the threat of nuclear war and nuclear proliferation in particular.  This article has estimated confidence and prediction intervals for the time to the next new nuclear-weapon state.  To this end, we built two two models, one being too pessimistic to be credible and the other more optimistic than is justified by the data considered.  The optimistic model estimates a `r as.numeric(round(100*probProlif1$label_year['label_prob.1']))` percent chance of at least one more nuclear-weapon state by `r as.numeric(round(probProlif1$label_year['label_year']))` and a `r as.numeric(round(100*probProlif1$label_year['label_prob.5']))` percent chance of 5 or more by that time.  

We can expect that some non-nuclear nations and terrorist groups would eagerly pursue nuclear weapons if such seemed feasible unless some unprecidented change in international law provided them with effective judicial recourse to perceived threats.  

Moreover, these weapons will become more available with the passage of time unless (a) a nuclear war destroys everyone's ability to make more such weapons for a long time, or (b) an international movement has far more success than similar previous efforts in giving the poor, weak and disfranchised effective nonviolent means for pursuing a redress of grievances.  

# Appendix.  Plotting to a file 

Plotting the time between "first tests" to a file was surprisingly difficult, because font sizes in the files were smaller than the standard display, and getting larger fonts was surprisingly difficult.  Consider the following:

````{r png}
if(FALSE){
  png('nuclearProliferation.png', 1440, 1200)
  par(mar=c(15, 12, 4, 2)+.1)
  plot(yearsSinceLastFirstTest~firstTest, 
     nuclearWeaponStates, type='h', 
     xlab='', ylab='', las=1, cex.axis=4, 
     bty='n', axes=FALSE, lwd=2, 
     ylim=ylim.)
  xyr <- seq(1950, 2000, 10)
  xt. <- paste0(xyr, '-01-01')
  xticks <- as.Date(xt.)
  axis(1, xticks, labels=FALSE, lwd=2)
  axis(1, xticks, xyr, cex.axis=4, lwd=0, line=2)
#axis(1, seq(1950, 2000, by=10), cex.axis=4, lwd=0, line=1)
  axis(2, cex.axis=4, las=1, lwd=2)
  title('Time between new nuclear nations', 
      cex.main=4)
addCountries(line=c(12, 2), cex.=4)
#mtext(paste0(
#'Note: The US is not on this plot,', 
#'\nbecause it had no predecessors.'), 
#1, 12, cex=4)
#mtext('years from the\nprevious "first test"',
#      2, 5, cex=4)
#  with(nuclearWeaponStates, 
#    text(firstTest, yearsSinceLastFirstTest,
#       ctry, xpd=TRUE, cex=4))
  dev.off()
}
```

Plot to an svg file, killing the labels for Wikimedia Commons:  

```{r svg}
if(FALSE){
  svg('nuclearProliferation.svg', 14, 11)
  Label. <- FALSE
  par(mar=c(9, 8, 4, 2)+.1)
  cex. <- 4
  plot(yearsSinceLastFirstTest~firstTest, 
     nuclearWeaponStates, type='h', 
     xlab='', ylab='', axes=FALSE, 
     bty='n', ylim=ylim.)
#  axis(1, cex.axis=cex., line=1)
  axis(1, labels=FALSE)
  axis.Date(1,
    nuclearWeaponStates$firstTest, 
    tick=FALSE, cex.axis=cex., line=2)
  axis(2, cex.axis=cex., las=1)
  if(Label.)title(
    'Time between new nuclear nations',
                  cex.main=2)
  if(Label.)addCountries(line=c(6, 4), cex=cex., 
        mtext.=Label.)  
#  noUS <- paste0(
#    'Note: The US is not on this plot,', 
#    '\nbecause it had no predecessors.')
#  if(Label.)mtext(noUS, 1, 6, cex=cex.)
#  ylab. <- paste(
#    'years from the\nprevious "first test"')
#  if(Label.)mtext(ylab., 2, 4, cex=cex.)
#  with(nuclearWeaponStates, 
#    text(firstTest, yearsSinceLastFirstTest,
#       ctry, xpd=TRUE, cex=cex.))
  dev.off()
}
```

Plot to png, killing the labeling for Wikimedia Commons

````{r png2}
#ymax <- max(nuclearWeaponStates$yearsSinceLastFirstTest, 
#            na.rm=TRUE)
#ylim. <- c(0, ymax)

png. <- FALSE
cex.ax=1 
lbl <- TRUE
if(png.){ 
    png('nuclearProliferation.png', 1440, 1200)
  if(lbl){
#    par(mar=c(15, 15, 7, 2)+.1)
    par(mar=c(15, 15, 2, 2)+.1)
  } else par(mar=c(5, 5, 2, 2)+.1)
    cex.ax=4
}
plotNucStates(type='h', ylim.=ylim0, 
    line=3:2, cex.=cex.ax, mtext.=lbl, log.='', 
    axes=FALSE)
    
#plot(yearsSinceLastFirstTest~firstTest, 
#     nuclearWeaponStates, type='h', 
#     xlab='', ylab='', las=1, cex.axis=cex.ax, 
#     bty='n', axes=FALSE, lwd=2, ylim=ylim.)
#if(lbl){
#  title('Figure 1. Time between\nnew nuclear nations', 
#    cex.main=cex.ax)
#addCountries(line=c(11, 6), cex=cex.ax)
#  xlab. <- paste(c('Note: The US is not on this plot,',
#                   'because it had no predecessors.'), 
#                 collapse='\n')
#  mtext(xlab., 1, 11, cex=cex.ax)
#  mtext('years from the\nprevious "first test"',
#        2, 6, cex=cex.ax)
#}
xyr <- seq(1950, 2000, 10)
xt. <- paste0(xyr, '-01-01')
xticks <- as.Date(xt.)
axis(1, xticks, labels=FALSE, lwd=2)
axis(1, xticks, xyr, cex.axis=cex.ax, lwd=0, line=0)
#axis(1, seq(1950, 2000, by=10), cex.axis=4, lwd=0, line=1)
axis(2, cex.axis=cex.ax, las=1, lwd=2)
#  title('Time between new nuclear nations', cex.main=4)
#xlab. <- paste0('Note: The US is not on this plot,', 
#    '\nbecause it had no predecessors.')
#  mtext(xlab., 1, 12, cex=4)
#ylab. <- paste0('Note: The US is not on this plot,', 
#    '\nbecause it had no predecessors.')
#  mtext(ylab., 1, 12, cex=4)
#  with(nuclearWeaponStates, 
#    text(firstTest, yearsSinceLastFirstTest,
#       ctry, xpd=TRUE, cex=cex.ax))
if(png.) dev.off()
```

# References

[^India]: [India had military conflicts with China in 1962 and 1967](https://en.wikipedia.org/wiki/China%E2%80%93India_relations) before India's first nuclear weapon's test 1974-05-18.  India and China have continued to have conflicts, including, e.g., [the Doklam standoff in 2017](https://en.wikipedia.org/wiki/2017_China%E2%80%93India_border_standoff).

[^Pak]: [India-Pakistan relations](https://en.wikipedia.org/wiki/India%E2%80%93Pakistan_relations) have been marked by frequent conflict since the two nations were born with the dissolution of the British Raj in 1947.  This history might help people understand the need that Pakistani leaders may have felt and still feel for nuclear parity with India. 

[^Israel]: [Israel faced many threats from its Arab neighbors before it became an independent nation in 1949](https://en.wikipedia.org/wiki/Arab%E2%80%93Israeli_conflict). These have continued, including the [Gaza border protests](https://en.wikipedia.org/wiki/2018_Gaza_border_protests) that have continued at least to mid 2019.  One might therefore reasonably understand why Israel might feel a need for nuclear weapons and why others might believe that the 1979-09-22 [Vela incident](https://en.wikipedia.org/wiki/Vela_Incident) was an Israeli nuclear test. 

[^quickNukes]: In addition to the 32 currently non-nuclear-weapon states with "sufficient fissile material to make nuclear weapons if they wished", per @Toon:2007, the inspector general of the US Department of Energy concluded in 2009 (in its most recent public accounting) that enough highly enriched uranium was missing from US inventories to make at least five nuclear bombs comparable to those that destroyed substantial portions of Hiroshima and Nagasaki in 1945.  Substantially more weapons-grade materials may be missing in other countries, especially Russia (@Malone:2018).   

[^ranWalk]: The [`bssm` package](https://www.rdocumentation.org/packages/bssm/versions/0.1.7) provides a reasonable framework for modeling this.  Its [`ng_bsm` function](https://www.rdocumentation.org/packages/bssm/versions/0.1.7/topics/ng_bsm) supports modeling a normal random walk in log(Poisson mean) of the number of "first tests" each year. This uses the fact that [the probability distribution of the time between events in a homogeneous Poisson point process is exponential](https://en.wikipedia.org/wiki/Exponential_distribution). 

[^WikivTime]: For precursors to the current study that involve censored estimation of time to a nuclear war, see @Wikiv:extinct and @Wikiv:Armageddon.

[^KP]:  @Levy:2007 say that Gallucci was a special adviser on WDMs to US Presidents Clinton and G. W. Bush.  The Wikipedia article on him says he was US Assistant Secretary of State for Political-Military Affairs from July 13, 1992 to October 11, 1994 under Presidents George H. W. Bush and Bill Clinton but not G. W. Bush.  Later, per @Gallucci:2001, "In March 1998, the Department of State announced his appointment as Special Envoy to deal with the threat posed by the proliferation of ballistic missiles and weapons of mass destruction. He held this position until January 2001."  G. W. Bush became US President 2001-01-20.  Thus, if Gallucci served under G. W. Bush, it was only for a few days.  Similar remarks about the US helping Pakistan's nuclear program were made by [Richard Barlow](https://en.wikipedia.org/wiki/Richard_Barlow_(Intelligence_analyst)#cite_note-wp-1), a CIA analyst who reported these questionable activities to a committee of the US House as noted by @Levy:2007. Barlow was reportedly severely punished for honestly answering questions in a classified briefing to an oversight committee of the US House.  Barlow said that US assistance to Pakistan's nuclear weapons program was in exchange for Pakistan's help in supplying rebels in Afghanistan fighting Soviet occupation.  This was during the [Iran-Contra affair](https://en.wikipedia.org/wiki/Iran%E2%80%93Contra_affair), which exposed actions of officials of the Reagan administration to pursue foreign policy objectives in Central America in blatant violation of law passed by Congress and signed by the President.

[^Pak2]:  @Burr:2012, @Burr:2013. There have also been reports that China helped Pakistan obtain nuclear weapons.  However, [China has vigorously denied those charges, many if not all of which may not be credible, having originated with the US government.](https://en.wikipedia.org/wiki/Pakistan_and_weapons_of_mass_destruction)  See @Wikip:PakNuc.
